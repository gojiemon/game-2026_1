(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();class H{constructor(t,e,i,s,a,r){Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"radius",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"speed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lane",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"appleIndex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:"#fbbf24"}),this.x=t,this.y=e,this.radius=i,this.speed=s,this.lane=a,this.appleIndex=r}update(t){this.y+=this.speed*t}draw(t,e){if(e){const i=this.radius*2;t.drawImage(e,this.x-i/2,this.y-i/2,i,i);return}t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fill()}}class N{constructor(t,e,i,s,a){Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"speed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:"#38bdf8"}),this.x=t,this.y=e,this.width=i,this.height=s,this.speed=a}update(t){this.y-=this.speed*t}draw(t){t.fillStyle=this.color,t.fillRect(this.x-this.width/2,this.y-this.height,this.width,this.height)}}function U(n,t,e){return Math.max(t,Math.min(e,n))}function W(n,t,e){return n+(t-n)*e}class Y{constructor(t,e){Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"radius",{enumerable:!0,configurable:!0,writable:!0,value:18}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:"#7dd3fc"}),Object.defineProperty(this,"smoothing",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.x=t,this.y=e}update(t,e){this.smoothing=1-Math.exp(-12*t),this.x=W(this.x,e,this.smoothing)}draw(t,e,i=0,s=1){const r=this.radius*6*s,o=this.x-r/2,h=this.y+i-r/2;if(e){t.drawImage(e,o,h,r,r);return}}}class X{constructor(t){Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mouseX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"wantShoot",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"wantRestart",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.canvas=t,this.bind()}bind(){this.canvas.addEventListener("pointermove",t=>{const e=this.canvas.getBoundingClientRect();this.mouseX=t.clientX-e.left}),this.canvas.addEventListener("pointerdown",t=>{t.button===0?this.wantShoot=!0:t.button===2&&(this.wantRestart=!0)}),this.canvas.addEventListener("contextmenu",t=>t.preventDefault())}getLane(){return this.mouseX<this.canvas.width/2?0:1}consumeShoot(){const t=this.wantShoot;return this.wantShoot=!1,t}consumeRestart(){const t=this.wantRestart;return this.wantRestart=!1,t}}const d=n=>new URL(n,"/game-2026_1/").toString();async function F(){const n=await b(d("assets/back.png")),t=await Promise.all([b(d("assets/apple1.png")),b(d("assets/apple2.png")),b(d("assets/apple3.png"))]),e=await b(d("assets/rabbit1.png")),i=await b(d("assets/rabbit3.png")),s=await b(d("assets/rabbit2.png")),a=await b(d("assets/rabbit4.png")),r=await b(d("assets/crate_state_0.png")),o=await b(d("assets/crate_state_1.png")),h=await b(d("assets/crate_state_2.png")),u=await b(d("assets/crate_state_3.png")),c=await b(d("assets/reward_bird.png.png"));return{background:n,apples:t,rabbitLeft:e,rabbitRight:i,rabbitJumpLeft:s,rabbitJumpRight:a,crateState0:r,crateState1:o,crateState2:h,crateState3:u,rewardBird:c}}function b(n){return new Promise((t,e)=>{const i=new Image;i.onload=()=>t(i),i.onerror=s=>{console.error("Image failed to load:",n,s),e(s)},i.src=n})}class V{constructor(){Object.defineProperty(this,"ctx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bgm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bgmStarted",{enumerable:!0,configurable:!0,writable:!0,value:!1})}ensureCtx(){if(!(typeof window>"u")){if(!this.ctx)try{this.ctx=new AudioContext}catch{return}return this.ctx.state==="suspended"&&this.ctx.resume(),this.ctx}}playShoot(){const t=this.ensureCtx();if(!t)return;const e=t.currentTime,i=t.createOscillator(),s=t.createGain();i.type="square",i.frequency.setValueAtTime(720,e),i.frequency.exponentialRampToValueAtTime(960,e+.08),s.gain.setValueAtTime(.16,e),s.gain.exponentialRampToValueAtTime(1e-4,e+.18),i.connect(s).connect(t.destination),i.start(e),i.stop(e+.2)}playBGM(){this.bgmStarted||(this.bgm||(this.bgm=new Audio("/assets/bgm.mp3"),this.bgm.loop=!0,this.bgm.volume=.25),this.bgmStarted=!0,this.bgm.play().catch(()=>{this.bgmStarted=!1}))}stopBGM(){this.bgm&&(this.bgm.pause(),this.bgm.currentTime=0,this.bgmStarted=!1)}}var p;(function(n){n.Start="start",n.Playing="playing",n.GameOver="gameover"})(p||(p={}));const S=2,z=960,$=200/z,q=.92,L=3,g=18,I=8,j=18,J=520,K=.22,A=.42,O=.3,_=48,Q=1.2,T=10,P=.12,Z=.62,x=20,E=20,R=8,tt=1,et=.35,st=.012,C=150,it=5.5,at=3,rt=7,nt=18,ot=1;class ht{constructor(t){Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ctx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"player",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"balls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"bullets",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"stacked",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"telegraphs",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:p.Start}),Object.defineProperty(this,"lastTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"elapsed",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"score",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"harvestCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"shootTimer",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"spawnTimer",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"startTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"lastLane",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"currentLane",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"jumpTimer",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"assetsLoaded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"assets",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loadingMessage",{enumerable:!0,configurable:!0,writable:!0,value:"Loading..."}),Object.defineProperty(this,"sound",{enumerable:!0,configurable:!0,writable:!0,value:new V}),Object.defineProperty(this,"crateLogged",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"loop",{enumerable:!0,configurable:!0,writable:!0,value:s=>{const a=(s-this.lastTime)/1e3;this.lastTime=s,this.update(a),this.draw(),requestAnimationFrame(this.loop)}}),Object.defineProperty(this,"handleResize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const s=this.canvas.width||1,a=this.canvas.height||1;this.setCanvasSize();const r=this.canvas.width/s,o=this.canvas.height/a;this.scaleEntities(r,o),this.player.x=this.laneToX(this.input.getLane()),this.player.y=this.getPlayerY()}}),this.canvas=t;const e=this.canvas.getContext("2d");if(!e)throw new Error("Canvas 2D context unavailable");this.ctx=e,this.input=new X(this.canvas),this.setCanvasSize();const i=this.laneToX(0);this.player=new Y(i,this.getPlayerY()),window.addEventListener("resize",this.handleResize),F().then(s=>{this.assets=s,this.assetsLoaded=!0}).catch(s=>{console.error("Failed to load assets",s),this.loadingMessage="Failed to load assets"})}start(){this.lastTime=performance.now(),requestAnimationFrame(this.loop)}resetGame(){this.balls=[],this.bullets=[],this.stacked=[],this.telegraphs=[],this.score=0,this.harvestCount=0,this.elapsed=0,this.shootTimer=0,this.spawnTimer=0,this.startTime=performance.now(),this.lastLane=Math.random()<.5?0:1}setCanvasSize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}scaleEntities(t,e){for(const i of this.balls)i.x*=t,i.y*=e;for(const i of this.bullets)i.x*=t,i.y*=e}getPlayerY(){return this.canvas.height-Math.floor(this.canvas.height*$)}getDefenseLineY(){return Math.floor(this.canvas.height*q)}update(t){if(this.state===p.Start){this.input.consumeShoot()&&(this.assetsLoaded?(this.sound.playBGM(),this.resetGame(),this.state=p.Playing):this.loadingMessage="Loading...");return}if(this.state===p.GameOver){this.input.consumeRestart()&&this.assetsLoaded&&(this.sound.playBGM(),this.resetGame(),this.state=p.Playing);return}this.elapsed=(performance.now()-this.startTime)/1e3,this.updateDifficulty(t),this.updatePlayer(t),this.updateTelegraphs(),this.handleSpawning(t),this.handleShooting(t),this.updateBullets(t),this.updateBalls(t),this.checkCollisions(),this.cleanup(),this.checkStackLimit()}updateDifficulty(t){this.shootTimer=Math.max(0,this.shootTimer-t),this.spawnTimer=Math.max(0,this.spawnTimer-t)}updatePlayer(t){const e=this.input.getLane();this.currentLane=e;const i=this.laneToX(e);this.player.update(t,i)}handleShooting(t){this.input.consumeShoot()&&this.shootTimer<=0&&this.jumpTimer<=0&&(this.jumpTimer=O,this.sound.playShoot(),this.shootTimer=K)}handleSpawning(t){const e=Math.max(et,tt-this.elapsed*st),i=Math.min(rt,at+Math.floor(this.elapsed/nt)*ot);if(this.spawnTimer<=0&&this.balls.length+this.telegraphs.length<i){const r=this.pickLane();this.telegraphs.push({lane:r,triggerTime:performance.now()+A*1e3}),this.spawnTimer=e}const s=performance.now(),a=[];for(const r of this.telegraphs)s>=r.triggerTime?this.spawnBall(r.lane):a.push(r);this.telegraphs=a}updateTelegraphs(){}updateBullets(t){this.jumpTimer=Math.max(0,this.jumpTimer-t)}updateBalls(t){const e=this.getDefenseLineY(),i=C+this.elapsed*it;for(const a of this.balls)a.speed=i,a.update(t);const s=[];for(const a of this.balls)a.y-a.radius>=e?this.stacked.push({lane:a.lane,appleIndex:a.appleIndex}):s.push(a);this.balls=s}checkCollisions(){const t=[],e=this.jumpTimer>0,i=e?1-this.jumpTimer/O:0,s=e?-Math.sin(Math.PI*i)*_:0,a=e?{x:this.player.x,y:this.player.y+s-this.player.radius,width:I,height:j}:null;for(const r of this.balls){let o=!1;a&&this.bulletHitsBall(a,r)&&(o=!0,this.score+=1,this.harvestCount+=1),o||t.push(r)}this.balls=t}cleanup(){}checkStackLimit(){this.stacked.length>=L&&this.state!==p.GameOver&&(this.state=p.GameOver,this.sound.stopBGM())}spawnBall(t){const e=this.laneToX(t),i=-g*2,s=new H(e,i,g,C,t,this.getRandomAppleIndex());this.balls.push(s)}spawnBullet(){const t=this.input.getLane(),e=this.laneToX(t),i=this.player.y-this.player.radius,s=new N(e,i,I,j,J);this.bullets.push(s)}laneToX(t){const e=this.canvas.width/S;return e*t+e/2}pickLane(){if(Math.random()<.35)return this.lastLane;const t=Math.random()<.5?0:1;return this.lastLane=t,t}bulletHitsBall(t,e){const i=t.x,s=t.y-t.height/2,a=i-e.x,r=s-e.y,o=e.radius+6;return a*a+r*r<=o*o}getRandomAppleIndex(){return Math.floor(Math.random()*3)}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBackground(),this.drawDefenseLine(),this.drawLaneDivider(),this.drawStackedBalls(),this.drawTelegraphs(),this.drawEntities(),this.drawHUD(),this.drawHarvestUI(),this.drawStateOverlays()}drawBackground(){var t;if(this.assetsLoaded&&((t=this.assets)!=null&&t.background))this.ctx.drawImage(this.assets.background,0,0,this.canvas.width,this.canvas.height);else{const e=this.ctx.createLinearGradient(0,0,0,this.canvas.height);e.addColorStop(0,"#0f172a"),e.addColorStop(1,"#0b1220"),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}drawLaneDivider(){this.ctx.strokeStyle="#1f2937",this.ctx.lineWidth=4,this.ctx.setLineDash([10,12]),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2,0),this.ctx.lineTo(this.canvas.width/2,this.canvas.height),this.ctx.stroke(),this.ctx.setLineDash([])}drawDefenseLine(){const t=this.getDefenseLineY();this.ctx.strokeStyle="#f472b6",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.canvas.width,t),this.ctx.stroke()}drawEntities(){var r;for(const o of this.balls){const h=(r=this.assets)==null?void 0:r.apples[o.appleIndex];o.draw(this.ctx,h)}const t=this.jumpTimer>0,e=t?1-this.jumpTimer/O:0,i=t?-Math.sin(Math.PI*e)*_:0,s=t?Q:1,a=(()=>{var o,h,u,c;return this.currentLane===0?t?(o=this.assets)==null?void 0:o.rabbitJumpLeft:(h=this.assets)==null?void 0:h.rabbitLeft:t?(u=this.assets)==null?void 0:u.rabbitJumpRight:(c=this.assets)==null?void 0:c.rabbitRight})();this.player.draw(this.ctx,a,i,s)}drawStackedBalls(){var a;const t=this.getDefenseLineY(),e=this.canvas.width/S,i=12,s=t+g+6;for(let r=0;r<S;r++){const o=r,h=this.stacked.filter(c=>c.lane===o),u=r*e+i+g;for(let c=0;c<h.length;c++){const w=u+c*(g*2+8),y=(a=this.assets)==null?void 0:a.apples[h[c].appleIndex];if(y){const l=g*2;this.ctx.drawImage(y,w-l/2,s-l/2,l,l)}else this.ctx.fillStyle="#f87171",this.ctx.beginPath(),this.ctx.arc(w,s,g,0,Math.PI*2),this.ctx.fill()}}}drawTelegraphs(){const t=performance.now();for(const e of this.telegraphs){const i=this.laneToX(e.lane),a=.35+.3*U((e.triggerTime-t)/(A*1e3),0,1);this.ctx.fillStyle=`rgba(56, 189, 248, ${a.toFixed(2)})`,this.ctx.beginPath(),this.ctx.arc(i,g*2,g*1.2,0,Math.PI*2),this.ctx.fill()}}drawHUD(){this.ctx.fillStyle="#e5e7eb",this.ctx.font='20px "Segoe UI", sans-serif',this.ctx.textAlign="left",this.ctx.fillText(`Harvest: ${this.harvestCount}`,20,34),this.ctx.fillText(`Score: ${this.score}`,20,60);const t=this.state===p.Playing?this.elapsed.toFixed(1):this.elapsed.toFixed(1);this.ctx.fillText(`Time: ${t}s`,20,86);const e=`STACK ${this.stacked.length}/${L}`;this.ctx.fillText(e,20,112)}drawStateOverlays(){if(!this.assetsLoaded){this.drawOverlay("Loading...","Assets are loading. Please wait.");return}this.state===p.Start?this.drawOverlay("Click to Start","Survive. Stack 3 = Game Over."):this.state===p.GameOver&&this.drawOverlay("Game Over",`Time ${this.elapsed.toFixed(1)}s | Score ${this.score} | Click to Restart`)}drawOverlay(t,e){this.ctx.fillStyle="rgba(0, 0, 0, 0.45)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#e5e7eb",this.ctx.textAlign="center",this.ctx.font='38px "Segoe UI", sans-serif',this.ctx.fillText(t,this.canvas.width/2,this.canvas.height/2-12),this.ctx.font='20px "Segoe UI", sans-serif',this.ctx.fillText(e,this.canvas.width/2,this.canvas.height/2+22)}drawHarvestUI(){const t=`UI DEBUG: crates=${Math.floor(this.harvestCount/T)} remainder=${this.harvestCount%T}`;if(this.ctx.fillStyle="#e5e7eb",this.ctx.font='14px "Segoe UI", sans-serif',this.ctx.textAlign="left",this.ctx.fillText(t,20,this.canvas.height-20),!this.assetsLoaded||!this.assets){const l=100*P,f=l*.8,m=this.canvas.width-x-l,v=this.canvas.height-E-f;this.ctx.strokeStyle="rgba(255,0,0,0.8)",this.ctx.lineWidth=2,this.ctx.strokeRect(m,v,l,f);return}const e=Math.floor(this.harvestCount/T),i=this.harvestCount%T,s=this.assets.crateState0,a=this.assets.crateState1,r=this.assets.crateState2,o=this.assets.crateState3,h=s.naturalWidth*P,u=s.naturalHeight*P,c=Math.round(u*Z),w=this.canvas.height-E-u;this.crateLogged||(console.log("Crate scale debug",{CRATE_SCALE:P,naturalW:s.naturalWidth,naturalH:s.naturalHeight,drawW:h,drawH:u}),this.crateLogged=!0);const y=Math.min(e,R);for(let l=0;l<y;l++){const f=l,m=this.canvas.width-x-h,v=w-f*c;this.ctx.drawImage(o,m,v,h,u)}if(i>0){const l=y,f=this.canvas.width-x-h,m=w-l*c,v=i>=6?o:i>=3?r:a;this.ctx.drawImage(v,f,m,h,u)}else if(e===0){const l=this.canvas.width-x-h,f=w;this.ctx.drawImage(s,l,f,h,u)}if(e>=5){const l=this.assets.rewardBird,f=h*.6,m=f*(l.height/l.width),v=Math.min(y-1,R-1),D=w-v*c,k=this.canvas.width-x-h-f*.1,G=D-m*.8;this.ctx.drawImage(l,k,G,f,m)}}}const M=document.querySelector("#app");if(!M)throw new Error("Root element not found");const B=document.createElement("canvas");M.appendChild(B);const lt=new ht(B);lt.start();
